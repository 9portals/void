<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Portal Void</title>
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD1YgjFsxh-xZfeHlrxt_0igmH6SBIMcuc",
      authDomain: "void-d9ec4.firebaseapp.com",
      projectId: "void-d9ec4",
      storageBucket: "void-d9ec4.appspot.com",
      messagingSenderId: "267268035851",
      appId: "1:267268035851:web:d535fe4175c06f170f3e0e",
      measurementId: "G-78DGNW8HV3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const messagesRef = collection(db, "messages");

    async function postMessage() {
      const input = document.getElementById('input');
      const text = input.value.trim();
      if (text === "") return;

      await addDoc(messagesRef, {
        text: text,
        createdAt: serverTimestamp()
      });

      input.value = '';
    }

    function renderMessage(id, data) {
      const div = document.createElement('div');
      div.className = 'message';
      div.id = id;
      div.innerHTML = `
        <span>${data.text}</span>
        <div class="timer" id="timer-${id}">60</div>
      `;
      document.getElementById('messages').prepend(div);

      let timeLeft = 60;
      const interval = setInterval(async () => {
        timeLeft--;
        const timerEl = document.getElementById(`timer-${id}`);
        if (timerEl) timerEl.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(interval);
          await deleteDoc(doc(db, "messages", id));
        }
      }, 1000);
    }

    const q = query(messagesRef, orderBy("createdAt", "desc"));
    onSnapshot(q, (snapshot) => {
      document.getElementById('messages').innerHTML = '';
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        renderMessage(docSnap.id, data);
      });
    });

  </script>

  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    #messages {
      margin-top: 20px;
      width: 100%;
      max-width: 600px;
    }
    .message {
      background: #222;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      position: relative;
    }
    .timer {
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 12px;
      color: gray;
    }
    input, button {
      padding: 10px;
      margin-top: 10px;
      width: 100%;
      max-width: 600px;
      font-size: 16px;
    }
  </style>
</head>

<body>

<h1>Welcome to The Void</h1>

<input id="input" placeholder="Type your message..." />
<button onclick="postMessage()">Post</button>

<div id="messages"></div>

</body>
</html>
